<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registrar Hora</title>
    <link rel="stylesheet" type="text/css" href="index.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.5/xlsx.full.min.js"></script>
    <script>
        function registrarHora() {
            // Obtener el valor ingresado en el input
            var codigoIngresado = document.getElementById("numeroInput").value;

            // Verificar si el input está vacío
            if (codigoIngresado.trim() === "") {
                alert("Por favor, ingrese un código antes de registrar la hora.");
                return; // Detener la ejecución si no hay un código ingresado
            }

            // Obtener la información correspondiente al código desde el archivo Excel
            leerArchivoExcel(codigoIngresado);
        }

        // Función para leer el archivo Excel y buscar la información correspondiente al código
        function leerArchivoExcel(codigo) {
            // Ruta al archivo Excel
            var archivoExcel = 'automa.xlsx';

            // Lee el archivo Excel
            var reader = new FileReader();
            reader.onload = function (e) {
                var data = new Uint8Array(e.target.result);
                var workbook = XLSX.read(data, { type: 'array' });

                // Selecciona la primera hoja del libro de trabajo
                var sheetName = workbook.SheetNames[0];
                var sheet = workbook.Sheets[sheetName];

                // Obtiene los datos de la hoja
                var datos = XLSX.utils.sheet_to_json(sheet, { header: 1 });

                // Busca la información correspondiente al código ingresado
                var informacionEncontrada = buscarInformacion(codigo, datos);

                // Muestra la información encontrada en el mensaje emergente
                mostrarInformacionEnEmergente(informacionEncontrada, codigo);
            };

            // Lee el contenido del archivo
            fetch(archivoExcel)
                .then((response) => response.arrayBuffer())
                .then((data) => reader.readAsArrayBuffer(new Blob([data])));
        }

        // Función para buscar la información correspondiente al código ingresado
        function buscarInformacion(codigo, datos) {
            // Implementa la lógica de búsqueda en tus datos
            // En este ejemplo, se busca en la primera columna de los datos
            for (var i = 0; i < datos.length; i++) {
                if (datos[i][0] == codigo) {
                    // Retorna la información encontrada
                    return datos[i];
                }
            }

            // Retorna null si no se encuentra información correspondiente al código
            return null;
        }

        // Función para mostrar la información encontrada en el mensaje emergente
        function mostrarInformacionEnEmergente(informacionEncontrada, codigo) {
            if (informacionEncontrada) {
                // Obtener la hora actual
                var fechaActual = new Date();
                var hora = fechaActual.getHours();
                var minutos = fechaActual.getMinutes();

                // Formatear la hora como HH:MM
                var horaFormateada = hora + ":" + minutos;

                // Obtener la opción seleccionada (entrada o salida)
                var tipoHora = document.getElementById("tipoHora").value;

                // Construir el mensaje
                var mensaje = "Código encontrado: " + informacionEncontrada[0] + "\nNombre: " + informacionEncontrada[1] + "\n" + tipoHora + ": " + horaFormateada;

                // Mostrar la información en el mensaje emergente
                alert(mensaje);

                // Preguntar al usuario si la información es correcta
                var respuesta = confirm("¿La información es correcta?");

                if (respuesta) {
                    // Si la respuesta es sí, puedes guardar la información (aún no implementado)
                    alert("Información guardada correctamente.");
                } else {
                    // Si la respuesta es no, puedes pedir al usuario que vuelva a ingresar el código
                    alert("Por favor, vuelva a ingresar el código.");
                }
            } else {
                // Mostrar un mensaje si no se encuentra información
                alert("No se encontró información correspondiente al código ingresado.");
            }
        }
    </script>
</head>
<body>
    <h1>Registrar Hora</h1>
    <label for="tipoHora">Seleccione tipo de hora:</label>
    <select id="tipoHora">
        <option value="Hora de Entrada">Hora de Entrada</option>
        <option value="Hora de Salida">Hora de Salida</option>
    </select>
    <br>
    <input type="text" id="numeroInput" placeholder="Ingrese su código" />
    <button onclick="registrarHora()">Registrar Hora Actual</button>
</body>
</html>
